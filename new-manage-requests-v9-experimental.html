$(document).on('click', '.view-details-button', function() {
    var itemId = $(this).data('id');
    openOffcanvas(itemId);
  });
  
  function openOffcanvas(itemId) {
    // Fetch item details using SharePoint REST API
    var apiUrl = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('PurchaseRequests')/items(" + itemId + ")";
    
    $.ajax({
      url: apiUrl,
      type: "GET",
      headers: {
        "Accept": "application/json;odata=verbose"
      },
      success: function(data) {
        var itemData = data.d; // Retrieve the item data from the response
        
        var offcanvasBody = '';
        offcanvasBody += '<div class="section">';
    offcanvasBody += '<h4><i class="fa fa-list"></i> General Information</h4>';
    offcanvasBody += '<div class="row px-2 pb-2">';
    offcanvasBody += '<div class="col-md-6">';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="requestor-name">Requestor Name:<sup>*</sup></span><span class="quick-view-data">' + itemData.Request_x0020_For + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="email">Email:<sup>*</sup></span><span class="quick-view-data">' + itemData.Email + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="department">Department:<sup>*</sup></span><span class="quick-view-data">' + itemData.Department + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="col-md-6">';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="dier-code">DIER Code:<sup>*</sup></span><span class="quick-view-data">' + itemData.DIER_x0020_Code + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="project-code">Project Code:</span><span class="quick-view-data">' + itemData.Project_x0020_Code + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="starting-manager">Starting Manager:<sup>*</sup></span><span class="quick-view-data">' + itemData.Comment + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="section">';
    offcanvasBody += '<h4><i class="fa fa-location-arrow"></i> Shipping & Location</h4>';
    offcanvasBody += '<div class="row px-2 pb-2">';
    offcanvasBody += '<div class="col-md-6">';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="ship-to-location">Ship To:<sup>*</sup></span><span class="quick-view-data">' + itemData.Ship_x0020_To + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '<div class="col-md-6">';
    offcanvasBody += '<div class="quick-view-data">';
    offcanvasBody += '<span class="attention-to">Attention To:<sup>*</sup></span><span class="quick-view-data">' + itemData.Attention_x0020_To + '</span>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
    offcanvasBody += '</div>';
        
        // Set the offcanvas body HTML
        $('.offcanvas-body').html(offcanvasBody);
  
        // Open the offcanvas
        $('.offcanvas').offcanvas('show');
      },
      error: function(error) {
        console.log("Error retrieving item details: " + JSON.stringify(error));
      }
    });
  }
  
  
  <div class="offcanvas offcanvas-end" tabindex="-1" id="detailsOffcanvas" aria-labelledby="detailsOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="detailsOffcanvasLabel">Item Details</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <!-- Item details will be populated here -->
    </div>
  </div>

  

























  function openOffcanvas(itemId) {
    // Fetch item details using SharePoint REST API
    var apiUrl = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('PurchaseRequests')/items(" + itemId + ")";
    
    $.ajax({
      url: apiUrl,
      type: "GET",
      headers: {
        "Accept": "application/json;odata=verbose"
      },
      success: function(data) {
        var itemData = data.d; // Retrieve the item data from the response
        
        var offcanvasBody = '';
        offcanvasBody += '<div class="section">';
        offcanvasBody += '<h4><i class="fa fa-list"></i> General Information</h4>';
        offcanvasBody += '<div class="row px-2 pb-2">';
        offcanvasBody += '<div class="col-md-6">';
        offcanvasBody += '<div class="quick-view-data">';
        offcanvasBody += '<label class="requestor-name">Requestor Name:<sup>*</sup></label>';
        offcanvasBody += '<input type="text" class="form-control" value="' + itemData.Request_x0020_For + '">';
        offcanvasBody += '</div>';
        offcanvasBody += '<div class="quick-view-data">';
        offcanvasBody += '<label class="email">Email:<sup>*</sup></label>';
        offcanvasBody += '<input type="text" class="form-control" value="' + itemData.Email + '">';
        offcanvasBody += '</div>';
        offcanvasBody += '<div class="quick-view-data">';
        offcanvasBody += '<label class="department">Department:<sup>*</sup></label>';
        offcanvasBody += '<input type="text" class="form-control" value="' + itemData.Department + '">';
        offcanvasBody += '</div>';
        offcanvasBody += '</div>';
        offcanvasBody += '<div class="col-md-6">';
        offcanvasBody += '<div class="quick-view-data">';
        offcanvasBody += '<label class="dier-code">DIER Code:<sup>*</sup></label>';
        offcanvasBody += '<input type="text" class="form-control" value="' + itemData.DIER_x0020_Code + '">';
        offcanvasBody += '</div>';
        offcanvasBody += '<div class="quick-view-data">';
        offcanvasBody += '<label class="project-code">Project Code:</label>';
        offcanvasBody += '<input type="text" class="form-control" value="' + itemData.Project_x0020_Code + '">';
        offcanvasBody += '</div>';
        offcanvasBody += '<div class="quick-view-data">';
        offcanvasBody += '<label class="starting-manager">Starting Manager:<sup>*</sup></label>';
        offcanvasBody += '<input type="text" class="form-control" value="' + itemData.Comment + '">';
        offcanvasBody += '</div>';
        offcanvasBody += '</div>';
        offcanvasBody += '</div>';
        offcanvasBody += '</div>';
  
        // Save button
        offcanvasBody += '<div class="section">';
        offcanvasBody += '<button type="button" class="btn btn-primary save-button">Save</button>';
        offcanvasBody += '</div>';
        
        // Set the offcanvas body HTML
        $('.offcanvas-body').html(offcanvasBody);
  
        // Open the offcanvas
        $('.offcanvas').offcanvas('show');
  
        // Save button click event handler
        $('.save-button').click(function() {
          var updatedData = {
            Request_x0020_For: $('.requestor-name input').val(),
            Email: $('.email input').val(),
            Department: $('.department input').val(),
            DIER_x0020_Code: $('.dier-code input').val(),
            Project_x0020_Code: $('.project-code input').val(),
            Comment: $('.starting-manager input').val()
          };
          
          // Send update request to update the SharePoint list item
          updateListItem(itemId, updatedData);
        });
      },
      error: function(error) {
        console.log("Error retrieving item details: " + JSON.stringify(error));
      }
    });
  }
  function updateListItem(itemId, itemData) {
    // Construct the endpoint URL for updating the SharePoint list item
    var apiUrl = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('PurchaseRequests')/items(" + itemId + ")";
    
    // Prepare the data to be sent in the request body
    var requestData = {
      __metadata: { type: "SP.Data.PurchaseRequestsListItem" }, // Replace with the actual list item entity type name
      // Map each field to its updated value
      Request_x0020_For: itemData.Request_x0020_For,
      Email: itemData.Email,
      Department: itemData.Department,
      DIER_x0020_Code: itemData.DIER_x0020_Code,
      Project_x0020_Code: itemData.Project_x0020_Code,
      Comment: itemData.Comment
    };
    
    $.ajax({
      url: apiUrl,
      type: "POST",
      contentType: "application/json;odata=verbose",
      data: JSON.stringify(requestData),
      headers: {
        "Accept": "application/json;odata=verbose",
        "X-HTTP-Method": "MERGE",
        "If-Match": "*"
      },
      success: function(data) {
        console.log("Item updated successfully");
        // Optionally, perform any additional actions after successful update
      },
      error: function(error) {
        console.log("Error updating item: " + JSON.stringify(error));
      }
    });
  }
  function updateListItem(itemId, itemData) {
    const spContext = pnp.sp.createWeb(_spPageContextInfo.webAbsoluteUrl);
    
    const listItem = spContext.lists.getByTitle('PurchaseRequests').items.getById(itemId);
    
    listItem.update(itemData)
      .then(() => {
        console.log("Item updated successfully");
      })
      .catch((error) => {
        console.log("Error updating item: " + error);
      });
  }  
  function updateListItem(itemId, itemData) {
    // Connect to the SharePoint site using PnP context
    const spContext = new $pnp.SPContext(_spPageContextInfo.webAbsoluteUrl);
    
    // Get the specific list item by ID
    const listItem = spContext.lists.getByTitle('PurchaseRequests').items.getById(itemId);
    
    // Update the item with the new field values
    listItem.update(itemData)
      .then(() => {
        console.log("Item updated successfully");
        // Optionally, perform any additional actions after successful update
      })
      .catch((error) => {
        console.log("Error updating item: " + error);
      });
  }
  function updateListItem(itemId, itemData) {
  // Connect to the SharePoint site using PnP context
  const spContext = pnp.sp.createBatch();

  // Get the specific list item by ID
  const listItem = spContext.web.lists.getByTitle('PurchaseRequests').items.getById(itemId);

  // Update the item with the new field values
  spContext.web.lists.getByTitle('PurchaseRequests').items.getById(itemId).update(itemData);

  // Execute the batch update
  spContext.execute()
    .then(() => {
      console.log("Item updated successfully");
      // Optionally, perform any additional actions after successful update
    })
    .catch((error) => {
      console.log("Error updating item: " + error);
    });
}
function updateListItem(itemId, itemData) {
    // Get the specific list item by ID
    var listItem = pnp.sp.web.lists.getByTitle('PurchaseRequests').items.getById(itemId);
    
    // Update the item with the new field values
    listItem.update(itemData)
        .then(() => {
            console.log("Item updated successfully");
            // Optionally, perform any additional actions after successful update
        })
        .catch((error) => {
            console.log("Error updating item: " + error);
        });
}
function openOffcanvas(itemId) {
  // Fetch item details using SharePoint REST API
  var apiUrl = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('PurchaseRequests')/items(" + itemId + ")";

  $.ajax({
    url: apiUrl,
    type: "GET",
    headers: {
      "Accept": "application/json;odata=verbose"
    },
    success: function(data) {
      var itemData = data.d; // Retrieve the item data from the response

      var offcanvasBody = '';

      // Loop through each tag within the offcanvas menu
      $('.offcanvas-menu span').each(function() {
        var internalName = $(this).data('internalname');
        var fieldValue = itemData[internalName];

        // Append a form control input element based on the internalName
        offcanvasBody += '<div class="form-group">';
        offcanvasBody += '<label for="' + internalName + '">' + internalName + '</label>';
        offcanvasBody += '<input type="text" class="form-control" id="' + internalName + '" value="' + fieldValue + '">';
        offcanvasBody += '</div>';
      });

      // Save button
      offcanvasBody += '<div class="section">';
      offcanvasBody += '<button type="button" class="btn btn-primary save-button">Save</button>';
      offcanvasBody += '</div>';

      // Set the offcanvas body HTML
      $('.offcanvas-body').html(offcanvasBody);

      // Open the offcanvas
      $('.offcanvas').offcanvas('show');

      // Save button click event handler
      $('.save-button').click(function() {
        var updatedData = {};

        // Loop through each input element and capture the updated values
        $('.offcanvas-body input').each(function() {
          var internalName = $(this).attr('id');
          var value = $(this).val();

          updatedData[internalName] = value;
        });

        // Send update request to update the SharePoint list item
        updateListItem(itemId, updatedData);
      });
    },
    error: function(error) {
      console.log("Error retrieving item details: " + JSON.stringify(error));
    }
  });
}
// Loop through each span tag with class "dataQuickLocate"
$('span.dataQuickLocate').each(function() {
    // Get the internal name from the data attribute
    var internalName = $(this).data('internalname');

    // Create a new input element
    var input = document.createElement('input');

    // Set input type as text
    input.type = 'text';

    // Set input class as form-control
    input.className = 'form-control';

    // Set input value as the data from the specified field
    input.value = data[internalName]; // Assume "data" is the object containing your SharePoint data

    // Append the input element to the span
    $(this).append(input);
});
